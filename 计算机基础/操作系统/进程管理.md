# 进程与线程

# 进程通信
**共享内存**
在内存中划分出共享存储区，需要通信的进程对这个共享存储区进行操作即可无需复制直接交换数据。

**管道通信**
管道用于连接一个读进程和一个写进程以实现它们之间通信的一个共享文件，又名pipe文件。管道机制必须实现三方面的协调能力：
* 互斥：当某一进程正在进行读写操作的时候，另一线程必须等待
* 同步：读写进程之间应该同步，读进程读完后就去等待写进程写，写进程写完后就去等待读进程读
* 确定对方是否存在：只有双方都存在的时候才能进行管道通信

**依赖消息传递系统**
将通信的数据封装在消息中，并利用操作系统提供的**原语**在进程间进行消息传递，完成数据交换。如在计算机网络中，通过报文传递数据；在微内核操作系统中，微内核与服务器也是通过消息传递机制实现的通信。
依赖消息传递系统的通信方式根据实现方式不同可分为两种：
* 直接通信方式：发送进程利用OS提供的发送原语，直接将消息发送给目标进程
* 简介通信方式：发送和接收进程，都通过共享中间实体（邮箱）的方式进行消息的发送和接收

**客户机服务器系统**
* socket：一个套接字包含目的地址、端口号、传输层协议等。是进程通信和网络通信的基本构建。套接字可以分为两种：
    * 基于文件：通信双方都在一台机器中。一个套接字关联到一个特殊的文件，类似于管道。
    * 基于网络：通信双方在不同的主机。此时会存在一对套接字来标识通信的两个进程。
* RPC：是一个通信协议，允许本地进程调用远程的进程。

# 进程同步
**锁**
一个线程占用某个资源，其它线程无法访问。锁是信号量的特例，信号量中当资源数量为1的时候就是锁。

**信号量**
一个线程完成某个动作就通过信号量通知其它线程。

# 进程调度算法
* 先来先服务：对短作业不公平。适合短作业较少的情况。
* 短作业优先：可能导致长作业饿死。
* 高响应比优先：`优先权 =（等待时间+要求服务时间）/（要求服务时间）`，优先权高的先进行调度。
* 时间片轮转：时间片太长会导致短作业响应时间变长。时间片太短会导致过多的今晨上下文切换。
* 基于优先级：可能导致低优先级饿死。
* 多级反馈队列：兼顾了长短队列，具有较好的响应时间。设置多个队列，每个队列优先级不同，优先级越高时间片越小；每个任务都先进入最高优先级队列中；当高优先级队列中存在任务，则立即停止当前任务；如果时间片用完了还没有完成任务，那么进入优先级更低的队列中；这样如果短作业来了会在最高优先级队列中立即处理完，对于长作业也不会一直不处理。

# 死锁
**死锁条件**
* 互斥
* 不剥夺
* 保持等待
* 循环等待

**避免死锁**
* 破坏互斥：将资源变成非临界资源
* 破坏不剥夺：资源可被剥夺
* 破坏保持等待：资源一次性分配
* 破坏循环等待：资源有序分配

